# フィギュアエディタ 要件定義書 v1.0

## 1. プロジェクト概要

### 1.1 アプリケーション名
フィギュアエディタ（Figure Editor）

### 1.2 目的・背景
- イラスト1枚から、フィギュアやアクリルスタンド風の画像を簡単に生成できるツール
- Google AI Studio（Nano Banana）で繰り返し生成する際の課題を解決
  - 同じChatでの生成が同じような結果に収束する
  - 新規Chat作成のたびにプロンプトをコピーする手間
  - 以前の生成結果が新しい生成に影響を与える
- プロンプト入力不要で、オプション選択のみで多彩な表現を実現

### 1.3 ターゲットユーザー
- イラストのフィギュア化を楽しむユーザー
- AIイラスト生成初心者でも簡単に使えることを重視
- プロンプト作成の知識がなくても高品質な画像を生成したいユーザー

### 1.4 成功基準
- プロンプト入力なしでフィギュア風画像の生成が可能
- 直感的なUI操作で誰でも簡単に使える
- 複数タブでの効率的な画像生成が可能
- 生成画像の一括管理・ダウンロードが可能

---

## 2. 技術要件

### 2.1 必須技術スタック
- **AI API**: Gemini API
  - デフォルトモデル: `gemini-2.5-flash-image`（Nano Banana）
  - 代替モデル: `gemini-3-pro-image-preview`（Nano Banana Pro）※Allowlist制限あり
- **PWA対応**: 必須
  - オフライン対応
  - インストール可能
  - Service Worker強制更新機能
- **APIキー管理**: 必須
  - ユーザーがAPIキーを入力・保存・削除できるUI
  - モーダルまたは設定ページ形式

### 2.2 技術制約
- Nano Bananaの仕様
  - `responseModalities: ['IMAGE']` のみ指定（テキスト応答を防ぐ）
  - URLパラメータ認証方式必須（`?key=...`）
  - レート制限（429エラー）への対応必要
- アスペクト比指定は必ずしも選択通りにならない場合がある
- 三面図生成中は他タブでの生成不可

### 2.3 Gemini API連携
- **プロンプト自動生成**: Gemini APIでプロンプト生成
  - 展示台オプションのプロンプト生成
  - 背景オプションのプロンプト生成
  - ロゴ用プロンプト生成
- **画像生成**: Nano Bananaで画像生成
- **翻訳機能**: 日本語プロンプト→英語プロンプト変換

---

## 3. 機能要件

### 3.1 画像アップロード機能

#### 3.1.1 基本機能
- **ドラッグ&ドロップ対応**: 画像ファイルをエリアにドロップ
- **ファイル選択**: クリックでファイル選択ウィンドウを開く
- **プレビュー表示**: アップロード後に画像プレビューを表示
- **画像リセット**: アップロードした画像のキャンセル・再選択

#### 3.1.2 制約
- 参照画像枚数
  - アスペクト比指定なし: 最大4枚
  - アスペクト比指定あり: 最大3枚

---

### 3.2 タブ管理機能

#### 3.2.1 基本機能
- **タブ追加**: 「+」ボタンで新規タブ作成
- **タブ切り替え**: 複数タブ間の切り替え
- **個別設定**: タブごとに異なる参照画像・設定で生成可能

#### 3.2.2 制約
- 三面図生成中は他タブでの生成を禁止
- 生成完了まで待機が必要

---

### 3.3 生成スタイル選択機能

#### 3.3.1 フィギュア
- **概要**: 参照画像を立体感のあるフィギュア風に変換
- **対応オプション**:
  - アスペクト比
  - パッケージオプション
  - 展示台オプション
  - 背景オプション

#### 3.3.2 三面図
- **概要**: 正面・側面・背面の3つの画像を1回で生成
- **サブオプション**:
  - フィギュア化して生成
  - 参照画像のまま生成
- **制約**:
  - 通常生成よりフィギュア化確率が低い
  - ポーズ・構図の再現性にバラつきあり
  - 何回か生成を繰り返す必要がある場合あり

#### 3.3.3 アクリルスタンド
- **概要**: 参照画像のタッチを保ち、透明台座付きアクリルスタンド風に変換
- **対応オプション**:
  - アスペクト比
  - 背景オプション

#### 3.3.4 線画
- **概要**: 参照画像から色彩・陰影を除去し、線画のみ抽出
- **対応オプション**:
  - アスペクト比

#### 3.3.5 自由生成
- **概要**: プロンプト自由記述でNano Bananaの機能をフル活用
- **機能**:
  - 日本語プロンプト入力
  - 英訳機能（Gemini API使用）
  - 英語プロンプト入力
  - 「日本語のまま生成」ボタン
  - 「英訳」ボタン
  - 「英語で生成」ボタン
- **対応オプション**:
  - アスペクト比（指定時は参照画像3枚まで）

---

### 3.4 アスペクト比指定機能

#### 3.4.1 選択肢
- 参照画像に合わせる（デフォルト）
- 1:1（正方形）
- 3:4（縦長）
- 4:3（横長）
- 9:16（スマホ画面 縦）
- 16:9（ワイド画面 横）

#### 3.4.2 対応スタイル
- フィギュア
- アクリルスタンド
- 線画
- 自由生成

#### 3.4.3 制約
- Nano Bananaの仕様上、必ずしも指定通りにならない場合がある
- 何回か試す必要がある

---

### 3.5 パッケージオプション機能

#### 3.5.1 対応スタイル
- フィギュアのみ

#### 3.5.2 パッケージ配置
- **パッケージ無し**: キャラクターのみフィギュア化
- **パッケージを置く**: フィギュアの背景にパッケージ配置
- **パッケージに入れる**: フィギュアをパッケージ内に配置

#### 3.5.3 パッケージカスタマイズ
- **文字入力**: 任意の文字列をパッケージに描画
- **ロゴ追加**:
  - ロゴ用文字入力（Geminiがプロンプト生成）
  - ロゴ画像アップロード
- **テクスチャ使用**: 参照画像をパッケージデザインとして使用

#### 3.5.4 注意事項
- 実在メーカー・ブランドのロゴ・商標が出現する可能性あり
- SNS公開時は画像加工推奨
- ロゴ指定で出現確率を大幅に低減可能

---

### 3.6 展示台オプション機能

#### 3.6.1 対応スタイル
- フィギュア（「パッケージに入れる」選択時は非表示）

#### 3.6.2 展示台ON/OFF
- デフォルト: OFF
- チェックボックスでON/OFF切り替え

#### 3.6.3 形状選択
- 円形
- 四角形
- 六角形

#### 3.6.4 材質・色・種類
1. **プラスチック**
   - カラーピッカーで色指定
   - RGB値直接入力可能
   - スポイト機能

2. **クリア**
   - カラーピッカーで色指定

3. **ゲーミング**
   - LED発光イメージ
   - レインボーオプション
   - 単色指定可能
   - 展示台色: 白固定

4. **木材**
   - 種類: オーク、ダークオーク、ウォールナット、メイプル、チェリー、マホガニー

5. **金属**
   - 種類: 金、銀、銅、クロム、ヘアライン、錆びた鉄
   - ヘアライン・錆びた鉄以外は鏡面仕上げ

6. **鉱物**
   - 種類: 大理石、御影石、黒曜石、水晶、ルビー、エメラルド、サファイア
   - 大理石・御影石以外は表面が鉱物特有の形状

7. **その他**
   - 自由記述
   - Geminiがプロンプト生成

#### 3.6.5 プロンプト生成
- 「展示台プロンプトを生成」ボタン
- 生成後の手動編集可能
- 「その他」選択時はGemini使用（処理時間あり）

---

### 3.7 背景オプション機能

#### 3.7.1 対応スタイル
- フィギュア
- アクリルスタンド

#### 3.7.2 背景ON/OFF
- デフォルト: OFF（基本プロンプトの背景使用）
- チェックボックスでON/OFF切り替え

#### 3.7.3 背景タイプ
1. **スタジオ**
   - 宣材写真風のライティング・背景

2. **ショップ**
   - フィギュアショップ店頭展示風
   - 注意: パッケージに意図しないロゴ・文字列が出やすい

3. **机の上**
   - 自宅デスク撮影風

4. **ジオラマ**
   - 参照画像の背景・キャラクターから推論してジオラマ化
   - 背景なし（単色）の場合: キャラクターから推論
   - 背景ありの場合: フィギュア化失敗率が高い
   - 推奨手順:
     1. まず参照画像をフィギュア化
     2. フィギュア画像を参照画像として再アップロード
     3. 元イラストの背景に近いキーワードで背景プロンプト生成

5. **その他**
   - 自由記述
   - Geminiがプロンプト生成

#### 3.7.4 プロンプト生成
- 「背景プロンプトを生成」ボタン
- Geminiがリアルタイム生成（毎回異なる雰囲気）
- 生成後の手動編集可能
- 繰り返し生成可能

---

### 3.8 生成機能

#### 3.8.1 生成枚数指定
- 最小: 1枚
- 最大: 8枚
- 同一プロンプトで連続生成

#### 3.8.2 生成実行
- 「生成」ボタンクリック
- 処理中はスピナー表示
- 生成時間: 数秒〜数十秒

---

### 3.9 画像ダウンロード機能

#### 3.9.1 表示機能
- **サムネイル表示**: 生成画像を一覧表示
- **拡大表示**: クリックでモーダルウィンドウ表示
- **画像送り**: 左右の「<」「>」で前後移動

#### 3.9.2 選択機能
- **個別選択**: サムネイル下のチェックボックス
- **拡大表示からの選択**: 「保存用にチェック」
- **一括選択/解除**: 「すべて解除｜選択」ボタン

#### 3.9.3 ダウンロード機能
- **個別ダウンロード**: 選択画像を個別にダウンロード
- **ZIPダウンロード**: 選択画像をZIPにまとめてダウンロード
  - フォルダ名指定可能（デフォルト: generated_images）
- **ダウンロード済み管理**:
  - 「ダウンロード済み」ラベル付与
  - サムネイルトーンダウン表示
  - チェックボックス自動OFF

---

## 4. 非機能要件

### 4.1 パフォーマンス要件
- 画像生成: Nano Banana APIのレスポンス時間に依存
- プロンプト生成: Gemini APIのレスポンス時間に依存
- UI操作: レスポンシブで快適な操作性

### 4.2 セキュリティ要件
- APIキーの安全な保存
- ローカルストレージまたは暗号化された保存方法
- APIキーの削除機能

### 4.3 ユーザビリティ要件
- 直感的なUI/UX
- AIイラスト生成初心者でも操作可能
- ドラッグ&ドロップ対応
- 分かりやすいオプション選択

### 4.4 互換性要件
- モダンブラウザ対応（Chrome、Firefox、Safari、Edge）
- PWA対応（インストール可能）
- レスポンシブデザイン（PC・タブレット・スマホ）

### 4.5 保守性要件
- Service Worker強制更新機能
- キャッシュ問題の解決
- オフライン対応

---

## 5. UI/UX要件

### 5.1 レイアウト構成
- **ヘッダー**: タブ管理（「+」ボタン、タブ切り替え）
- **メインエリア**:
  - 画像アップロードエリア
  - 生成スタイル選択
  - オプション選択セクション
  - 生成枚数指定
  - 生成ボタン
- **結果表示エリア**:
  - サムネイル一覧
  - 拡大表示モーダル
  - ダウンロードコントロール

### 5.2 インタラクション
- ドラッグ&ドロップのビジュアルフィードバック
- オプション選択時の展開/折りたたみ
- カラーピッカー
- プロンプト生成中のローディング表示
- 画像生成中のプログレス表示

### 5.3 エラーハンドリング
- APIキー未設定時の警告
- ファイルアップロードエラー
- API呼び出しエラー（429レート制限含む）
- 三面図生成中の他タブ生成禁止メッセージ

---

## 6. データ要件

### 6.1 入力データ
- 参照画像（JPEG、PNG等の画像ファイル）
- APIキー（ユーザー入力）
- オプション選択値
- カスタムプロンプト（自由生成モード）

### 6.2 出力データ
- 生成画像（PNG形式、Base64デコード後）
- プロンプト（展示台・背景用）
- 英訳プロンプト（自由生成モード）

### 6.3 保存データ
- APIキー（ローカルストレージ）
- ダウンロード済み画像の管理情報
- ユーザー設定（オプション履歴等、必要に応じて）

---

## 7. 開発優先度

### 7.1 Phase 0: 開発環境構築
- [ ] Next.js 14プロジェクトセットアップ
- [ ] PWA設定
- [ ] APIキー管理UI実装

### 7.2 Phase 1: 基本機能（必須）
- [ ] 画像アップロード機能
- [ ] タブ管理機能
- [ ] 生成スタイル選択（フィギュア）
- [ ] 基本的な画像生成機能
- [ ] 生成結果表示
- [ ] 画像ダウンロード機能

### 7.3 Phase 2: オプション機能（重要）
- [ ] アスペクト比指定
- [ ] パッケージオプション
- [ ] 展示台オプション
- [ ] 背景オプション
- [ ] プロンプト自動生成（Gemini連携）

### 7.4 Phase 3: 追加生成スタイル（重要）
- [ ] 三面図
- [ ] アクリルスタンド
- [ ] 線画
- [ ] 自由生成

### 7.5 Phase 4: UX改善（推奨）
- [ ] カラーピッカー
- [ ] プロンプト編集機能
- [ ] ダウンロード済み管理
- [ ] 一括選択/解除

---

## 8. 制約事項・注意事項

### 8.1 技術的制約
- Nano Bananaの仕様による制約
  - アスペクト比が必ずしも指定通りにならない
  - 生成品質のバラつき
- Gemini API のレート制限
- 三面図生成の再現性問題

### 8.2 法的リスク
- 実在メーカー・ブランドのロゴ・商標出現の可能性
- SNS公開時の画像加工推奨
- ユーザーへの注意喚起が必要

### 8.3 運用上の注意
- APIキーはユーザー自身で取得・管理
- API使用料金はユーザー負担
- 生成失敗時の再試行が必要な場合がある

---

## 9. 将来的な拡張可能性

### 9.1 機能拡張
- 三面図でのアスペクト比指定対応
- 展示台「ゲーミング」の色指定拡張
- 新しい生成スタイルの追加
- バッチ処理（複数画像の一括処理）

### 9.2 AI機能拡張
- Nano Banana Pro（`gemini-3-pro-image-preview`）への対応
- 他の画像生成モデルへの対応
- プロンプト最適化機能

### 9.3 UX改善
- 生成履歴の保存
- お気に入り機能
- プリセット保存機能
- プロンプトテンプレート

---

## 10. 参考情報

### 10.1 関連技術ドキュメント
- Gemini API公式ドキュメント
- Nano Banana仕様
- PWA実装ガイド

### 10.2 プロジェクト関連
- 100Appsプロジェクト共通仕様（CLAUDE.md）
- Gemini API実装方法（CLAUDE.md）
- PWA Service Worker設定（CLAUDE.md）

---

**文書履歴**
- v1.0 (2025-12-12): 初版作成
